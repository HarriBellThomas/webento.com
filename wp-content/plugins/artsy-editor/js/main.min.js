var artsy={};var timer1;var timer2;var timer3;var timer4;artsy.postTitle="";artsy.postContent="";artsy.gettingStartedTitle="How to use Artsy Editor?";artsy.gettingStartedContent='<p>Few things to help you get started:</p><ul><li>When you select some text, the formatting box show up. You can <strong>bold</strong>, <em>italicize</em>, <a href="http://google.com">link</a>, create list, and a lot more.</li><li>Drag in an image or use bottom right button to choose one, it will be uploaded & inserted automatically.</li><li>Resize it by hovering over image and dragging the handle. Click the image to edit its metadata.</li><li>When the post is ready, click Publish on top right. Or press X on top left to add tags/categories/custom settings.</li><li>Several options (HTML mode, save draft, preview) will show if you hover over + next to Publish button.</li><li>You can customize the interface by clicking Settings icon on bottom left. There is also a list of FAQs and handy keyboard shortcuts.</li></ul><p>Feel free to save this post as a draft for future reference! Hover over + next to Publish button and click Save Draft.</p><p>If you need more help, visit <a target="_blank" href="http://artsyeditor.com/getting-started/">http://artsyeditor.com/getting-started/</a>, we have tutorials that cover bits and pieces.</p>';artsy.originalSizes=new Array();artsy.pathEditor="#artsy-editor-container";artsy.pathContent=artsy.pathEditor+" #artsy-editor-content";artsy.pathHTMLContent=artsy.pathEditor+" #artsy-editor-content-html";artsy.pathTitle=artsy.pathEditor+" #artsy-editor-title";artsy.pathBackground="#artsy-background";artsy.pathMenu="#artsy-menu";artsy.pathLink="a#edButtonArtsy";artsy.pathFileUpload=artsy.pathEditor+" #artsy-file-upload";artsy.pathFileUploadTipsDiv=artsy.pathBackground+" .tips-container";artsy.pathFileUploadTips=artsy.pathBackground+" .tips";artsy.pathEditorBoxButton=artsy.pathEditor+" #artsy-close";artsy.pathSettingsBox="#artsy-editor-settings";artsy.pathEditorBox="#artsy-editor-box";artsy.pathSettingsBoxButton=artsy.pathEditor+" #artsy-settings";artsy.pathPublishButton=artsy.pathEditor+" #artsy-publish";artsy.pathSaveDraftButton=artsy.pathEditor+" #artsy-save-draft";artsy.pathPreviewButton=artsy.pathEditor+" #artsy-preview";artsy.pathMoveToTrashButton=artsy.pathEditor+" #artsy-move-to-trash";artsy.pathHTMLModeButton=artsy.pathEditor+" #artsy-html-toggle";artsy.pathWordCount="#artsy-word-count";artsy.pathMask="#artsy-mask";artsy.pathResizeImage=".artsy-resize-image";artsy.pathImageBox="#artsy-image-box";artsy.pathResizeDimension="#resize-dimensions";artsy.pathNewParagraph="#artsy-new-paragraph";artsy.pathCurrentPosition="#current-position";artsy.pathCancelSettings="#cancel-settings";artsy.pathInputLink="#input-link";artsy.pathInputImageTitle="#input-image-title";artsy.pathInputImageAlt="#input-image-alt";artsy.pathInputImageCap="#input-image-cap";artsy.pathInputImageLink="#input-image-link";artsy.pathInputImageWidth="#input-image-width";artsy.pathInputImageHeight="#input-image-height";artsy.pathOriginalSize="#original-size-button";artsy.pathDeleteImage="#delete-image-button";artsy.pathNewWindow="#action-newWindow";artsy.pathUIWrapper=".ui-wrapper";artsy.pathWPTitle="#post-body-content input#title";artsy.pathWPContent="#post-body-content textarea#content";artsy.pathWPWrap="#wpwrap";artsy.pathWPFooter="#footer";artsy.pathWPContentArea="#wpcontent";artsy.pathWPPublish="#publish";artsy.pathWPSaveDraft="#save-post";artsy.pathStyleBlock="#artsy-style-block";artsy.backgroundStyleID="#artsy-background-css";artsy.imageIdentifier="artsy-image-id";artsy.linkIdentifier="artsy-link-id";artsy.editorAppendage="#wpwrap #content-tmce";artsy.selectedText="";artsy.rangeStart=0;artsy.rangeEnd=0;artsy.parentElementHref="";artsy.parentElementTarget="";artsy.formatBlocks=["p","blockquote","h1","h2","h3","h4","h5","h6","code","pre","address"];artsy.viewMode="visual";artsy.junkOpen=true;artsy.hasSetup=false;artsy.justInitiated=false;artsy.currentlyResizing=false;artsy.didDraggedOver=false;artsy.draggedSelectionInContent=false;artsy.fileUploadSetup=false;artsy.enteredContent=false;artsy.enteredDocument=false;artsy.inputFileActivate=false;artsy.contentPasted=false;artsy.autoSaveSetup=false;artsy.enteredInnerContent=false;artsy.modifiedKeyPressed=null;jQuery(document).ready(function(){artsy.init()});artsy.init=function(){var data={action:"getHTML",postID:jQuery("#post_ID").val()};jQuery.post(ajaxurl,data,function(response){response=eval("("+response+")");jQuery("body").prepend(response.uploadBox);jQuery("body").prepend(response.imageBox);jQuery("body").prepend(response.settingsBox);jQuery("body").prepend(response.editorBox);jQuery("body").prepend(response.editor);jQuery(artsy.pathEditor).add(artsy.pathBackground).css("display","none");jQuery(artsy.pathHTMLContent).css("display","none");jQuery(artsy.editorAppendage).after('<a id="edButtonArtsy" class="hide-if-no-js" onclick="switchEditors.go(\'content\', \'artsy\');">Artsy</a>');var shortcutsEscape=[{keys:"Esc",method:function(){artsy.escKeyPressed()}}];jQuery.each(shortcutsEscape,function(index,elem){shortcut.add(elem.keys,function(){elem.method();return false},{type:"keydown",propagate:false})});if(jQuery("#artsy_open-automatically").text()==1){jQuery(artsy.pathLink).trigger("click");artsy.justInitiated=true}})};artsy.runEditor=function(){artsy.fresheditor=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{$.error("Method "+c+" does not exist on jQuery.contentEditable")}}return};var a=[{keys:"Meta+,",method:function(){artsy.toggleSettingsBox()}},{keys:"Meta+b",method:function(){b.bold.apply(this)}},{keys:"Meta+i",method:function(){b.italicize.apply(this)}},{keys:"Meta+u",method:function(){b.underline.apply(this)}},{keys:"Meta+k",method:function(){b.createLink.apply(this)}},{keys:"Meta+0",method:function(){b.formatBlock.apply(this,["<p>"])}},{keys:"Meta+1",method:function(){b.formatBlock.apply(this,["<h1>"])}},{keys:"Meta+2",method:function(){b.formatBlock.apply(this,["<h2>"])}},{keys:"Meta+3",method:function(){b.formatBlock.apply(this,["<h3>"])}},{keys:"Meta+4",method:function(){b.formatBlock.apply(this,["<h4>"])}},{keys:"Meta+5",method:function(){b.formatBlock.apply(this,["<h5>"])}},{keys:"Meta+6",method:function(){b.formatBlock.apply(this,["<h6>"])}},{keys:"Shift+Alt+b",method:function(){b.bold.apply(this)}},{keys:"Shift+Alt+i",method:function(){b.italicize.apply(this)}},{keys:"Shift+Alt+k",method:function(){b.createLink.apply(this)}},{keys:"Shift+Alt+0",method:function(){b.formatBlock.apply(this,["<p>"])}},{keys:"Shift+Alt+1",method:function(){b.formatBlock.apply(this,["<h1>"])}},{keys:"Shift+Alt+2",method:function(){b.formatBlock.apply(this,["<h2>"])}},{keys:"Shift+Alt+3",method:function(){b.formatBlock.apply(this,["<h3>"])}},{keys:"Shift+Alt+4",method:function(){b.formatBlock.apply(this,["<h4>"])}},{keys:"Shift+Alt+5",method:function(){b.formatBlock.apply(this,["<h5>"])}},{keys:"Shift+Alt+6",method:function(){b.formatBlock.apply(this,["<h6>"])}},{keys:"Shift+Alt+d",method:function(){b.strikethrough.apply(this)}},{keys:"Shift+Alt+a",method:function(){b.createLink.apply(this)}},{keys:"Shift+Alt+s",method:function(){b.unlink.apply(this)}},{keys:"Shift+Alt+u",method:function(){b.unorderedList.apply(this)}},{keys:"Shift+Alt+o",method:function(){b.orderedList.apply(this)}},{keys:"Shift+Alt+q",method:function(){b.formatBlock.apply(this,["<blockquote>"])}},{keys:"Shift+Alt+p",method:function(){b.formatBlock.apply(this,["p"])}},{keys:"Shift+Alt+l",method:function(){b.justifyLeft.apply(this)}},{keys:"Shift+Alt+c",method:function(){b.justifyCenter.apply(this)}},{keys:"Shift+Alt+r",method:function(){b.justifyRight.apply(this)}},{keys:"Shift+Alt+j",method:function(){b.justifyFull.apply(this)}}];var b={bold:function(){document.execCommand("bold",false,null)},italicize:function(){document.execCommand("italic",false,null)},underline:function(){document.execCommand("underline",false,null)},strikethrough:function(){document.execCommand("strikethrough",false,null)},justifyLeft:function(){document.execCommand("justifyLeft",false,null)},justifyCenter:function(){document.execCommand("justifyCenter",false,null)},justifyRight:function(){document.execCommand("justifyRight",false,null)},justifyFull:function(){document.execCommand("justifyFull",false,null)},orderedList:function(){document.execCommand("InsertOrderedList",false,null)},unorderedList:function(){document.execCommand("InsertUnorderedList",false,null)},indent:function(){document.execCommand("indent",false,null)},outdent:function(){document.execCommand("outdent",false,null)},createLink:function(){artsy.currentRandomID=artsy.generateRandomID();var c="artsy-link-"+artsy.currentRandomID;document.execCommand("createLink",false,c);jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).focus()},unlink:function(){document.execCommand("unlink",false);jQuery(artsy.pathEditorBox).find("input"+artsy.pathInputLink).val("");document.getElementById("artsy-editor-content").normalize()},formatBlock:function(c){if(c==artsy.commonFormatBlock){c=["<p>"]}else{if(c.substr(1,1)=="h"){artsy.changeHeaderButton(c)}}document.execCommand("FormatBlock",null,c);artsy.getSelected()},unbind:function(c){jQuery.each(a,function(d,e){shortcut.remove(e.keys)})},init:function(c){jQuery(artsy.pathEditorBox).find("button").mousedown(function(){artsy.restoreSelection(artsy.savedSelection)});jQuery("button#action-bold").click(function(){b.bold.apply(this);return false});jQuery("button#action-italicize").click(function(){b.italicize.apply(this);return false});jQuery("button#action-underline").click(function(){b.underline.apply(this);return false});jQuery("button#action-strikethrough").click(function(){b.strikethrough.apply(this);return false});jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).mousedown(function(){if(!jQuery(this).hasClass("active")){jQuery(this).addClass("active");b.createLink.apply(this);return false}});jQuery("img#clear-url").click(function(){b.unlink.apply(this);return false});jQuery("button#action-insertOrderedList").click(function(){b.orderedList.apply(this);return false});jQuery("button#action-insertUnorderedList").click(function(){b.unorderedList.apply(this);return false});jQuery("button#action-alignLeft").click(function(){b.justifyLeft.apply(this);return false});jQuery("button#action-alignMiddle").click(function(){b.justifyCenter.apply(this);return false});jQuery("button#action-alignRight").click(function(){b.justifyRight.apply(this);return false});jQuery("button#action-alignWrap").click(function(){b.justifyFull.apply(this);return false});jQuery("button#action-p").click(function(){b.formatBlock.apply(this,["<p>"]);return false});jQuery("button#action-quotes").click(function(){b.formatBlock.apply(this,["<blockquote>"]);return false});jQuery("button.heading-change").click(function(){b.formatBlock.apply(this,["<"+jQuery(this).attr("title")+">"]);return false});jQuery("button.show-hidden-row").click(function(){jQuery(artsy.pathEditorBox).find(".hidden-row").slideToggle("fast")});document.execCommand("enableObjectResizing",false,"false");jQuery.each(a,function(d,e){shortcut.add(e.keys,function(){e.method();artsy.modifiedKeyPressed=true;return false},{type:"keydown",propagate:false})})}};if(artsy_editor_mode=="visual-mode"||artsy_editor_mode=="html-mode"){artsy.viewMode=artsy_editor_mode.replace("-mode","")}artsy.openEditor();return false};artsy.openEditor=function(){jQuery("#wpadminbar").hide();artsy.getTitleAndContent();artsy.openContent();artsy.windowWidth=jQuery(window).width();artsy.windowHeight=jQuery(window).height();artsy.documentWidth=jQuery(document).width();artsy.documentHeight=jQuery(document).height();jQuery(artsy.pathWPContentArea).height(artsy.windowHeight-50);jQuery(artsy.pathWPContentArea).css("overflow","hidden");if(artsy_show_word_count==0){jQuery(artsy.pathWordCount).hide()}artsy.fresheditor("init");jQuery("#artsy-publish").add("#publish-control").text(jQuery(artsy.pathWPPublish).val());artsy.settingsFontOriginal=jQuery("#artsy_font").text();artsy.settingsFontSizeOriginal=jQuery("#artsy_font-size").text();artsy.settingsBackgroundOriginal=jQuery("#artsy_background").text();artsy.settingsShowWordCountOriginal=jQuery("#artsy_show-word-count").text();jQuery(artsy.pathTitle).blur(function(){artsy.autoSave(true)});jQuery(artsy.pathContent).focus(function(){if(artsy.autoSaveSetup==false){artsy.autoSave(true);jQuery.cancel(jQuery.schedule({time:autosaveL10n.autosaveInterval*1000,func:function(){autosave()},repeat:true,protect:true}));jQuery.schedule({time:autosaveL10n.autosaveInterval*500,func:function(){artsy.autoSave(false)},repeat:true,protect:true});artsy.autoSaveSetup=true}});if(jQuery("#artsy_open-automatically").text()==1){jQuery(artsy.pathWPTitle).blur()}jQuery(artsy.pathFileUpload).css("display","block");if(jQuery(artsy.pathWPSaveDraft).length==0){jQuery(artsy.pathSaveDraftButton).remove()}jQuery(artsy.pathFileUpload).find("input").click(function(){jQuery(artsy.pathEditorBox).css("display","none");jQuery(artsy.pathImageBox).css("display","none");if(artsy.draggedSelectionInContent==false){artsy.initFileUpload();artsy.inputFileActivate=true}else{artsy.destroyFileUpload()}});jQuery(document).bind("dragenter",function(a){jQuery(artsy.pathTitle).blur();a.stopPropagation();artsy.enteredDocument=true;if(artsy.enteredContent!==true){if(artsy.draggedSelectionInContent==false){artsy.initFileUpload();artsy.inputFileActivate=true}else{artsy.destroyFileUpload()}}});jQuery(document).bind("dragleave",function(a){a.stopPropagation();artsy.enteredDocument=false;if(artsy.enteredContent!==true){if(artsy.draggedSelectionInContent==false){artsy.destroyFileUpload()}}});jQuery(artsy.pathContent).bind("dragenter",function(a){a.stopPropagation();if(artsy.enteredDocument==false&&artsy.draggedSelectionInContent==false){artsy.initFileUpload();artsy.inputFileActivate=true}artsy.enteredContent=true});jQuery(artsy.pathContent).bind("dragleave",function(a){a.stopPropagation();if(artsy.enteredDocument==false&&artsy.draggedSelectionInContent==false&&artsy.enteredInnerContent==false){artsy.destroyFileUpload()}artsy.enteredContent=false});jQuery(artsy.pathContent).find("*").bind("dragenter",function(a){artsy.enteredInnerContent=true});jQuery(artsy.pathContent).find("*").bind("dragleave",function(a){timer3=setTimeout(function(){artsy.enteredInnerContent=false},1)});jQuery(artsy.pathContent).bind("dragstart",function(){if(artsy.inputFileActivate==true){artsy.destroyFileUpload()}artsy.draggedSelectionInContent=true});jQuery(artsy.pathContent).bind("dragend",function(){artsy.destroyFileUpload();artsy.draggedSelectionInContent=false});jQuery(artsy.pathEditorBoxButton).click(function(){artsy.closeEditor()});jQuery(artsy.pathSettingsBox+" select, "+artsy.pathSettingsBox+" input").change(function(){artsy.settingsFormChange(this)});jQuery(artsy.pathSettingsBox).find("form").submit(function(){artsy.submitSettingsForm();return false});jQuery(artsy.pathEditorBox).find("form").submit(function(){artsy.submitLinkForm();return false});jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).focus(function(){artsy.savedSelection=artsy.saveSelection()});jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).keyup(function(){artsy.editLinkForm();return false});jQuery(artsy.pathEditorBox).find(artsy.pathNewWindow).change(function(){artsy.editLinkForm();return false});jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).blur(function(){jQuery(this).removeClass("active");artsy.editLinkBlurForm();return false});jQuery(artsy.pathSettingsBoxButton).click(function(){artsy.toggleSettingsBox()});jQuery(".cancel_settings, "+artsy.pathMask).click(function(){jQuery(artsy.pathCancelSettings).trigger("click");return false});jQuery(".toggle-secondary-control").mouseenter(function(){jQuery(".secondary-control").slideDown("fast")});jQuery("#artsy-status-control").mouseleave(function(){jQuery(".secondary-control").slideUp("fast")});jQuery(artsy.pathEditor).mouseup(function(a){artsy.closeImageBox();timer3=setTimeout(function(){artsy.getSelected();artsy.toggleEditorBox(a)},1)});jQuery(artsy.pathContent).keydown(function(a){artsy.keyPressed=a.which;artsy.wrappedInParagraph=false});jQuery(artsy.pathContent).keypress(function(a){artsy.keyPressed=a.which;artsy.wrappedInParagraph=false});jQuery(artsy.pathContent).bind("DOMNodeInserted",function(a){if(artsy.wrappedInParagraph==false){jQuery(artsy.pathContent).contents().filter(function(){if(this.nodeType==3&&(this.nodeValue!=""||jQuery(artsy.pathEditor).hasClass("browser-safari")==true)&&this.nodeValue!="\n"){artsy.wrappedInParagraph=true;timer3=setTimeout(function(){artsy.focusAtTheEnd(jQuery(artsy.pathNewParagraph).get(0));jQuery(artsy.pathNewParagraph).removeAttr("id")},1)}return(this.nodeType==3&&(this.nodeValue!=""||jQuery(artsy.pathEditor).hasClass("browser-safari")==true)&&this.nodeValue!="\n")}).wrap('<p id="artsy-new-paragraph" />');if(jQuery(artsy.pathNewParagraph).length!=0){text=jQuery(artsy.pathNewParagraph).text();match1=" ";html=jQuery(artsy.pathNewParagraph).html();match2="&nbsp;";if((text!=match1&&text.substr(text.length-1)==match1||html!=match2&&html.substr(html.length-6)==match2)&&a.which!=32){jQuery(artsy.pathNewParagraph).text(text.substring(0,text.length-1));artsy.focusAtTheEnd(jQuery(artsy.pathNewParagraph).get(0));jQuery(artsy.pathNewParagraph).removeAttr("id")}}}if(artsy.keyPressed==13){if(artsy.contentPasted==false){if(a.target.nodeName.toLowerCase()=="div"&&jQuery(a.target).text()==""&&jQuery(a.target).hasClass("artsy-resize-image")==false&&jQuery(a.target).hasClass("ui-wrapper")==false&&jQuery(a.target).hasClass("ui-resizable-handle")==false){jQuery(a.target).replaceWith('<p id="artsy-new-paragraph">&nbsp;</p>');artsy.focusAtTheBeginning(jQuery(artsy.pathNewParagraph).get(0));jQuery(artsy.pathNewParagraph).removeAttr("id")}else{if(jQuery(a.target).hasClass("artsy-resize-image")==true){jQuery(a.target.parentNode).after('<p id="artsy-new-paragraph">&nbsp;</p>');artsy.focusAtTheBeginning(jQuery(artsy.pathNewParagraph).get(0));jQuery(artsy.pathNewParagraph).removeAttr("id")}else{if(jQuery(artsy.pathEditor).hasClass("browser-gecko")==true&&a.target.nodeName.toLowerCase()=="br"&&jQuery(a.target.parentNode).hasClass("artsy-resize-image")==true){jQuery(a.target).attr("id","artsy-new-break");jQuery(artsy.pathResizeImage).parent().after('<p id="artsy-new-paragraph">&nbsp;</p>');artsy.focusAtTheBeginning(jQuery(artsy.pathNewParagraph).get(0));jQuery(artsy.pathNewParagraph).removeAttr("id")}}}}else{if(a.target.nodeName.toLowerCase()=="span"&&a.target.getAttribute("class")=="Apple-style-span"){selection=artsy.saveSelection();jQuery(a.target).removeAttr("style");jQuery(a.target).find("*").each(function(){jQuery(this).removeAttr("style")});jQuery(".Apple-style-span").replaceWith(jQuery(".Apple-style-span").html());artsy.restoreSelection(selection)}}jQuery(artsy.pathContent).find("meta").remove();jQuery(artsy.pathContent).find(".Apple-interchange-newline").remove();jQuery(artsy.pathContent).find("#artsy-new-break").remove()}if(artsy.keyPressed==8&&a.target.nodeName.toLowerCase()=="br"){jQuery(a.target).replaceWith('<p id="artsy-new-paragraph">&nbsp;</p>');artsy.focusAtTheBeginning(jQuery(artsy.pathNewParagraph).get(0))}});jQuery(artsy.pathContent).dblclick(function(a){artsy.closeImageBox();artsy.selectedInContent=true;timer3=setTimeout(function(){artsy.openEditorBox(a)},1)});jQuery(artsy.pathContent).bind("paste",function(a){artsy.contentPasted=true;timer3=setTimeout(function(){artsy.contentPasted=false},1)});jQuery(artsy.pathContent).find("img").bind("dragend",function(a){artsy.imageMoved()});jQuery(artsy.pathContent).keyup(function(a){artsy.doWordCount(false);if(a.which!=27){jQuery(artsy.pathEditor).trigger("mouseup")}});jQuery(artsy.pathEditor).mousemove(function(a){artsy.openJunk()});jQuery(window).resize(function(){artsy.windowWidth=jQuery(window).width();artsy.windowHeight=jQuery(window).height();artsy.documentWidth=jQuery(document).width();artsy.documentHeight=jQuery(document).height();jQuery(artsy.pathWPContentArea).height(artsy.windowHeight-50)});jQuery(artsy.pathPublishButton).click(function(){artsy.toggleEditor();jQuery(artsy.pathWPPublish).trigger("click")});jQuery(artsy.pathSaveDraftButton).click(function(){artsy.toggleEditor();jQuery(artsy.pathWPSaveDraft).trigger("click")});jQuery(artsy.pathPreviewButton).click(function(){artsy.saveContent();artsy.returnTitleAndContent(true);jQuery("a#post-preview").trigger("click");artsy.openContent()});jQuery(artsy.pathMoveToTrashButton).click(function(){artsy.toggleEditor();jQuery("#delete-action a.submitdelete.deletion").trigger("click")});if(artsy.viewMode=="html"){artsy.viewMode="visual";artsy.toggleViewMode();artsy.viewMode="html"}jQuery(artsy.pathEditor).add(artsy.pathBackground).show();if(jQuery(artsy.pathTitle).val()==""){jQuery(artsy.pathTitle).focus()}else{if(jQuery(artsy.pathContent).text()==""){jQuery(artsy.pathTitle).select()}else{jQuery(artsy.pathContent).focus()}}};artsy.closeEditor=function(){jQuery("#wpadminbar").show();jQuery.cancel(jQuery.schedule({time:autosaveL10n.autosaveInterval*500,func:function(){artsy.autoSave(false)},repeat:true,protect:true}));jQuery.schedule({time:autosaveL10n.autosaveInterval*1000,func:function(){autosave()},repeat:true,protect:true});artsy.autoSaveSetup=false;artsy.saveContent();artsy.returnTitleAndContent(true);artsy.destroyFileUpload();jQuery("#edButtonArtsy").removeClass("active");jQuery("#"+jQuery("#edButtonArtsy").data("editor_type")).addClass("active");jQuery(artsy.pathEditorBoxButton).add(artsy.pathSettingsBoxButton).add(artsy.pathImageBox).add(artsy.pathEditorBox+" button").add(".cancel_settings").add(artsy.pathMask).add(artsy.pathPublishButton).add(artsy.pathSaveDraftButton).unbind("click");jQuery(artsy.pathEditor).unbind("mousemove");jQuery(window).unbind("resize");artsy.fresheditor("unbind");jQuery(artsy.pathWPContentArea).css("height","auto");jQuery(artsy.pathWPContentArea).css("overflow","");artsy.justInitiated=false;artsy.hasSetup=false;artsy.closeAllBoxes();jQuery(artsy.pathEditor).add(artsy.pathBackground).hide();jQuery(artsy.pathWPTitle).focus();jQuery(artsy.pathFileUpload).css("display","none")};artsy.toggleViewMode=function(){switch(artsy.viewMode){case"visual":artsy.saveContent();jQuery(artsy.pathContent).css("display","none");jQuery(artsy.pathHTMLContent).css("display","");jQuery(artsy.pathWordCount).hide();jQuery(artsy.pathHTMLModeButton).text("Visual Mode");artsy.openContent();artsy.viewMode="html";break;case"html":artsy.saveContent();jQuery(artsy.pathContent).css("display","");jQuery(artsy.pathHTMLContent).css("display","none");jQuery(artsy.pathWordCount).show();jQuery(artsy.pathHTMLModeButton).text("HTML Mode");artsy.openContent();artsy.viewMode="visual";break}};artsy.getTitleAndContent=function(){artsy.postTitle=jQuery(artsy.pathWPTitle).val();if(tinyMCE.activeEditor!=null&&!tinyMCE.activeEditor.isHidden()&&tinyMCE.activeEditor.getContent()!=""){artsy.postContent=tinyMCE.activeEditor.getContent()}else{artsy.postContent=jQuery(artsy.pathWPContent).val()}if(jQuery("#artsy-help-shown").val()==0&&(artsy.postTitle==""||artsy.postTitle=="<br />\n")){artsy.postTitle=artsy.gettingStartedTitle}if(jQuery("#artsy-help-shown").val()==0&&(artsy.postContent==""||artsy.postContent=="<br />\n")){artsy.postContent=artsy.gettingStartedContent}else{if(artsy.postContent==""||artsy.postContent=="<br />\n"){if(jQuery(artsy.pathEditor).hasClass("browser-gecko")==false){artsy.postContent=""}else{artsy.postContent="<p>&nbsp;</p>"}}}artsy.postContent=artsy.postContent.replace(/\[caption([^\]]+)\]([\s\S]+?)\[\/caption\]/g,"<figure$1>$2</figure>\n\n");jQuery(artsy.pathTitle).val(artsy.postTitle);jQuery(artsy.pathContent).html(switchEditors._wp_Autop(artsy.postContent));jQuery(artsy.pathHTMLContent).val(switchEditors._wp_Nop(artsy.postContent))};artsy.returnTitleAndContent=function(a){jQuery(artsy.pathWPTitle).val(artsy.postTitle);artsy.postContent=switchEditors._wp_Autop(artsy.postContent);putback=false;if(a==true){tinyMCE.execCommand("mceSetContent",false,artsy.postContent)}else{if(tinyMCE.activeEditor!=null&&!tinyMCE.activeEditor.isHidden()){switchEditors.go("content","html");putback=true}}jQuery(artsy.pathWPContent).val(switchEditors._wp_Nop(artsy.postContent));if(putback==true){switchEditors.go("content","tinymce")}};artsy.openContent=function(){artsy.doWordCount(false);artsy.initImages();jQuery(artsy.pathContent+" a").each(function(){jQuery(this).attr(artsy.linkIdentifier,artsy.generateRandomID())})};artsy.saveContent=function(){jQuery(artsy.pathContent).find("img").each(function(){jQuery(artsy.pathResizeDimension).remove();jQuery(this).resizable("destroy");jQuery(this).removeAttr("style");jQuery(this).unbind("click")});jQuery(artsy.pathNewParagraph).each(function(){jQuery(this).removeAttr("id")});jQuery(artsy.pathContent).find(".Apple-style-span").each(function(){jQuery(this).removeAttr("class")});jQuery(artsy.pathContent+", "+artsy.pathContent+" p, "+artsy.pathContent+" blockquote, "+artsy.pathContent+" ul, "+artsy.pathContent+" ol, "+artsy.pathContent+" li span").each(function(){jQuery(this).css("font-size","");jQuery(this).css("line-height","");if(jQuery(this).attr("style")==""){jQuery(this).removeAttr("style")}});jQuery(artsy.pathContent).find("p").last().each(function(){if(jQuery(this).text()==""||jQuery(this).text()==" "||jQuery(this).html()=="\n"){jQuery(this).remove()}});jQuery(artsy.pathContent).find(artsy.pathResizeImage).each(function(){jQuery(this).contents().unwrap()});jQuery(artsy.pathContent).find("img").each(function(){if(typeof jQuery(this).attr("link")!="undefined"&&jQuery(this).attr("link")!=""){jQuery(this).wrap('<a href="'+jQuery(this).attr("link")+'" />')}jQuery(this).removeAttr("link")});jQuery(artsy.pathNewParagraph).removeAttr("id");jQuery("a["+artsy.linkIdentifier+"]").removeAttr(artsy.linkIdentifier);jQuery("img["+artsy.imageIdentifier+"]").removeAttr(artsy.imageIdentifier);jQuery(artsy.pathContent+" p, "+artsy.pathContent+" span").removeAttr("style");artsy.postTitle=jQuery(artsy.pathTitle).val();if(artsy.viewMode=="visual"){artsy.postContent=jQuery(artsy.pathContent).html()}else{artsy.postContent=jQuery(artsy.pathHTMLContent).val()}artsy.postContent=artsy.postContent.replace(/(\<a href="[^\]]+">)\<img([^\]]+)width="([0-9]+)"([^\]]+)cap="([^\]]+)"([^\]]+)attachment-id="attachment_([0-9]+)">(\<\/a>)/g,'[caption id="attachment_$7" width="$3" caption="$5"]$1<img$2width="$3"$4$6 />$8[/caption]\n\n');artsy.postContent=artsy.postContent.replace(/\<img([^\]]+)width="([0-9]+)"([^\]]+)cap="([^\]]+)"([^\]]+)attachment-id="attachment_([0-9]+)">/g,'[caption id="attachment_$6" width="$2" caption="$4"]<img$1width="$2"$3$5 />[/caption]\n\n');artsy.postContent=switchEditors._wp_Nop(artsy.postContent);artsy.postContent=artsy.postContent.replace(/<span style="font-weight: bold;">([^>]+?)<\/span>/ig,"<strong>$1</strong>");artsy.postContent=artsy.postContent.replace(/<span style="font-style: italic;">([^>]+?)<\/span>/ig,"<em>$1</em>");artsy.postContent=artsy.postContent.replace(/<b>/ig,"<strong>");artsy.postContent=artsy.postContent.replace(/<i>/ig,"<em>");artsy.postContent=artsy.postContent.replace(/<u>/ig,'<span style="text-decoration: underline;">');artsy.postContent=artsy.postContent.replace(/<strike>/ig,'<span style="text-decoration: line-through;">');artsy.postContent=artsy.postContent.replace(/<\/b>/ig,"</strong>");artsy.postContent=artsy.postContent.replace(/<\/i>/ig,"</em>");artsy.postContent=artsy.postContent.replace(/<\/u>/ig,"</span>");artsy.postContent=artsy.postContent.replace(/<\/strike>/ig,"</span>");artsy.postContent=artsy.postContent.replace(/<\/a><a [^>]+?>/ig,"");if(artsy.viewMode=="visual"){jQuery(artsy.pathHTMLContent).val(artsy.postContent)}else{jQuery(artsy.pathContent).html(switchEditors._wp_Autop(artsy.postContent))}};artsy.autoSave=function(a){if(artsy.hasSetup==true){selection=artsy.saveSelection();artsy.saveContent();artsy.returnTitleAndContent(false);if(a==true){delayed_autosave()}else{autosave()}artsy.openContent();artsy.restoreSelection(selection)}};artsy.focusAtTheBeginning=function(a){window.setTimeout(function(){var c,b;if(window.getSelection&&document.createRange){b=document.createRange();b.selectNodeContents(a);b.collapse(true);c=window.getSelection();c.removeAllRanges();c.addRange(b)}else{if(document.body.createTextRange){b=document.body.createTextRange();b.moveToElementText(a);b.collapse(true);b.select()}}},1)};artsy.focusAtTheEnd=function(a){window.setTimeout(function(){var c,b;if(window.getSelection&&document.createRange){b=document.createRange();b.selectNodeContents(a);b.collapse(false);c=window.getSelection();c.removeAllRanges();c.addRange(b)}else{if(document.body.createTextRange){b=document.body.createTextRange();b.moveToElementText(a);b.collapse(false);b.select()}}},1)};artsy.focusAll=function(a){window.setTimeout(function(){var c,b;if(window.getSelection&&document.createRange){b=document.createRange();b.selectNodeContents(a);c=window.getSelection();c.removeAllRanges();c.addRange(b)}else{if(document.body.createTextRange){b=document.body.createTextRange();b.moveToElementText(a);b.select()}}},1)};artsy.toggleEditor=function(){if(artsy.hasSetup==false){artsy.runEditor();artsy.hasSetup=true}else{if(jQuery(artsy.pathEditor).css("display")=="none"){artsy.openEditor()}else{artsy.closeEditor()}}};artsy.escKeyPressed=function(){if(jQuery(artsy.pathSettingsBox).css("display")=="block"){artsy.closeSettingsBox()}else{if(jQuery(artsy.pathImageBox).css("display")=="block"){artsy.closeImageBox()}else{if(jQuery(artsy.pathEditorBox).css("display")=="block"){artsy.closeEditorBox()}else{artsy.toggleEditor()}}}};artsy.initFileUpload=function(){artsy.getCursorPosition();if(artsy.fileUploadSetup==false){artsy.fileUploadSetup=true;jQuery(artsy.pathFileUpload).fileUploadUI({dropZone:jQuery(document),onDragOver:function(a){jQuery(artsy.pathFileUploadTips).text("Release to upload.");if(artsy.didDraggedOver==false){jQuery(artsy.pathFileUploadTipsDiv).animate({top:-1},150);artsy.didDraggedOver=true}},onDragLeave:function(a){jQuery(artsy.pathFileUploadTips).text("");if(artsy.enteredContent!==true){jQuery(artsy.pathFileUploadTipsDiv).animate({top:-36},150)}artsy.didDraggedOver=false},onDrop:function(a){jQuery(artsy.pathFileUploadTips).text("Invalid data.");clearTimeout(timer2);timer2=setTimeout("jQuery(artsy.pathFileUploadTips).text('');jQuery(artsy.pathFileUploadTipsDiv).animate({'top': -36}, 150);",1000)},onSend:function(d,c,a,e,b){jQuery(artsy.pathFileUploadTipsDiv).animate({top:-1},150);jQuery(artsy.pathFileUploadTips).text("Uploading now.")},onProgress:function(d,c,a,e,b){jQuery(artsy.pathFileUploadTips).text("Uploaded "+parseInt(d.loaded/d.total*100,10)+"%.")},onError:function(d,c,a,e,b){if(b.originalEvent){console.log(b.response.error)}else{console.log(b.response.error)}jQuery(artsy.pathFileUploadTips).text("Error.");timer2=setTimeout("jQuery(artsy.pathFileUploadTips).text('');jQuery(artsy.pathFileUploadTipsDiv).animate({'top': -36}, 150);",2000)},onComplete:function(d,c,a,e,b){if(b.response.error==""){content=artsy.getImageTag(b.response.id,b.response.url,b.response.width,b.response.height,b.response.title,"","",b.response.url,"none","full");if(jQuery(artsy.pathCurrentPosition).length>0){jQuery(artsy.pathCurrentPosition).after(content)}else{jQuery(artsy.pathContent).append(content)}artsy.didDraggedOver=false;jQuery("img["+artsy.imageIdentifier+"="+artsy.currentRandomID+"]").each(function(){if(jQuery(this).parent().attr("id")!="artsy-editor-content"){html=artsy.getOuterHTML(this);tag=this.parentNode.nodeName.toLowerCase();jQuery(this.parentNode).replaceWith(artsy.getOuterHTML(this.parentNode).replace(html,"</"+tag+">"+html+"<"+tag+">"));artsy.focusAtTheEnd(jQuery(this).parent().get(0))}});artsy.setupNewImage(artsy.currentRandomID,b.response.width,b.response.height);jQuery(artsy.pathContent).find("img").bind("dragend",function(f){artsy.destroyFileUpload();artsy.draggedSelectionInContent=false;artsy.imageMoved()});jQuery(artsy.pathFileUploadTips).text("Upload completed.");artsy.destroyFileUpload();timer2=setTimeout("jQuery(artsy.pathFileUploadTipsDiv).animate({'top': -36}, 150);",1000)}else{if(b.response.error=="filetype"){jQuery(artsy.pathFileUploadTips).text("Sorry. Only image is supported.");clearTimeout(timer2);timer2=setTimeout("jQuery(artsy.pathFileUploadTips).text('');jQuery(artsy.pathFileUploadTipsDiv).animate({'top': -36}, 150);",3000)}}}})}};artsy.destroyFileUpload=function(b){timer2=setTimeout("jQuery(artsy.pathCurrentPosition).remove();",1);if(artsy.fileUploadSetup==true){jQuery(artsy.pathFileUploadTips).text("");jQuery(artsy.pathFileUploadTipsDiv).animate({top:-36},150);artsy.fileUploadSetup=false;jQuery(artsy.pathFileUpload).fileUploadUI("destroy")}};artsy.imageMoved=function(){jQuery(artsy.pathContent).find("meta").remove();jQuery(artsy.pathResizeImage).each(function(){if(jQuery(this).find("img").length==0){jQuery(this).remove()}});clearTimeout(timer3);timer3=setTimeout("artsy.initImages();",1);jQuery(artsy.pathContent).find("img").bind("dragend",function(a){artsy.imageMoved()})};artsy.initImages=function(){jQuery(artsy.pathContent+" img").each(function(){id=artsy.generateRandomID();jQuery(this).attr(artsy.imageIdentifier,id);element=jQuery(this).parent().get(0);if(element.nodeName.toLowerCase()=="a"){jQuery(this).attr("link",element.getAttribute("href"));jQuery(this).unwrap()}element0=jQuery(this).parents().get(0);element1=jQuery(this).parents().get(1);if(element0.nodeName.toLowerCase()=="figure"){jQuery(this).attr("cap",element0.getAttribute("caption"));jQuery(this).attr("attachment-id",element0.getAttribute("id"));jQuery(this).unwrap()}else{if(element1.nodeName.toLowerCase()=="figure"){jQuery(this).attr("cap",element1.getAttribute("caption"));jQuery(this).attr("attachment-id",element1.getAttribute("id"));jQuery(element0).unwrap()}}artsy.setupNewImage(id,jQuery(this).width(),jQuery(this).height())})};artsy.setupNewImage=function(a){id=a;a="img["+artsy.imageIdentifier+"="+a+"]";width=jQuery(a).width();height=jQuery(a).height();jQuery(a).data("width",width);jQuery(a).data("height",height);artsy.originalSizes.push({id:id,width:width,height:height});jQuery(jQuery(a)[0]).wrap('<div class="artsy-resize-image" />');jQuery(a).click(function(b){artsy.imageID=a;artsy.toggleImageBox(b)});if(jQuery(a).hasClass("alignright")==true){jQuery(a).parent().css("float","right")}else{if(jQuery(a).hasClass("alignleft")==true){jQuery(a).parent().css("float","left")}else{if(jQuery(a).hasClass("aligncenter")==true){jQuery(a).parent().css("text-align","center")}}}jQuery(a).mouseenter(function(b){if(jQuery(a).hasClass("alignright")==true){handle="sw"}if(jQuery(a).hasClass("aligncenter")==true){handle="se, sw"}else{handle="se"}jQuery(a).resizable({handles:handle,create:function(c,d){jQuery(a).parent().css("position","relative");if(jQuery(a).hasClass("aligncenter")==true){margin=(800-34-jQuery(a).width())/2;jQuery(a).parent().css("margin-left",margin+"px").css("margin-right",margin+"px")}},resize:function(c,d){jQuery(artsy.pathUIWrapper).css("left","0px");jQuery(artsy.pathInputImageWidth).val(jQuery(a).width());jQuery(artsy.pathInputImageHeight).val(jQuery(a).height());jQuery(artsy.pathResizeDimension).html("W: "+jQuery(a).width()+" H: "+jQuery(a).height());if(jQuery(a).hasClass("aligncenter")==true){margin=(800-34-jQuery(a).width())/2;jQuery(a).parent().css("margin-left",margin+"px").css("margin-right",margin+"px")}},start:function(c,d){jQuery(a).parent().parent().append('<div id="resize-dimensions"></div>');artsy.currentlyResizing=true},stop:function(c,d){jQuery(a).attr("width",jQuery(a).width());jQuery(a).attr("height",jQuery(a).height());jQuery(artsy.pathResizeDimension).remove();artsy.currentlyResizing=false}});jQuery(artsy.pathUIWrapper).mouseleave(function(c){if(artsy.currentlyResizing==false){jQuery(jQuery(this).children()).removeAttr("style");jQuery(this).resizable("destroy")}})})};artsy.openEditorBox=function(c){if(artsy.selectedInContent==true&&artsy.modifiedKeyPressed!=true){if(artsy.commonFormatBlock=="<h1>"||artsy.commonFormatBlock=="<h2>"||artsy.commonFormatBlock=="<h3>"||artsy.commonFormatBlock=="<h4>"||artsy.commonFormatBlock=="<h5>"||artsy.commonFormatBlock=="<h6>"){jQuery(artsy.pathEditorBox).find(".hidden-row").css("display","block")}else{jQuery(artsy.pathEditorBox).find(".hidden-row").css("display","none")}jQuery(artsy.pathImageBox).css("display","none");if(artsy.parentElementHref==""){value="http://"}else{value=artsy.parentElementHref}jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).val(value);if(jQuery().jquery>="1.6"){if(artsy.parentElementTarget=="_blank"){jQuery(artsy.pathEditorBox).find(artsy.pathNewWindow).prop("checked",true)}else{jQuery(artsy.pathEditorBox).find(artsy.pathNewWindow).prop("checked",false)}}else{if(artsy.parentElementTarget=="_blank"){jQuery(artsy.pathEditorBox).find(artsy.pathNewWindow).attr("checked","checked")}else{jQuery(artsy.pathEditorBox).find(artsy.pathNewWindow).removeAttr("checked")}}jQuery(artsy.pathBackground).fadeIn("fast");jQuery(artsy.pathEditorBox).fadeIn("fast");if(typeof c.clientY=="undefined"){clientY=artsy.windowHeight/2}else{clientY=c.clientY}if(typeof c.clientX=="undefined"){clientX=artsy.windowWidth/2}else{clientX=c.clientX}if(typeof c.pageY=="undefined"){pageY=artsy.documentHeight/2}else{pageY=c.pageY}if(typeof c.pageX=="undefined"){pageX=artsy.documentWidth/2}else{pageX=c.pageX}var a=pageY+20;var b=pageX-170;var f=artsy.documentHeight-pageY;var d=artsy.documentWidth-pageX;if(b<10){b=10}if(d<190){b=artsy.documentWidth-350}if(artsy.windowHeight-clientY<200){a=pageY-200}if(typeof c.pageX=="undefined"||typeof c.pageY=="undefined"){a=jQuery("body").scrollTop()+(clientY/2);b=clientX-180}jQuery(artsy.pathEditorBox).css("left",b+"px").css("top",a+"px");artsy.selectedInContent=false}else{if(artsy.modifiedKeyPressed==true){artsy.modifiedKeyPressed=null}}};artsy.closeEditorBox=function(){artsy.clearLink('a[href="artsy-link-'+artsy.currentRandomID+'"]');artsy.clearLink('a[href="http://"]');jQuery(artsy.pathEditorBox).fadeOut("fast")};artsy.toggleEditorBox=function(a){if(artsy.selectedText.length>0){artsy.openEditorBox(a)}else{if(jQuery(artsy.pathEditorBox).css("display")!="none"){artsy.closeEditorBox()}}};artsy.editLinkForm=function(){artsy.savedSelection=artsy.saveSelection();url=jQuery(artsy.pathEditorBox).find("form "+artsy.pathInputLink).val();newWindow=jQuery(artsy.pathEditorBox).find("form "+artsy.pathNewWindow+":checked").val();if(url!=""){jQuery('a[href="artsy-link-'+artsy.currentRandomID+'"]').attr(artsy.linkIdentifier,artsy.currentRandomID);jQuery("a["+artsy.linkIdentifier+'="'+artsy.currentRandomID+'"]').attr("href",url);if(newWindow==1){jQuery("a["+artsy.linkIdentifier+'="'+artsy.currentRandomID+'"]').attr("target","_blank")}else{jQuery("a["+artsy.linkIdentifier+'="'+artsy.currentRandomID+'"]').removeAttr("target")}}};artsy.editLinkBlurForm=function(){artsy.editLinkForm();url=jQuery(artsy.pathEditorBox).find(artsy.pathInputLink).val();if(url==""){artsy.clearLink("a["+artsy.linkIdentifier+'="'+artsy.currentRandomID+'"]')}};artsy.submitLinkForm=function(){artsy.editLinkForm();artsy.closeEditorBox()};artsy.editImageForm=function(){jQuery(artsy.imageID).attr("title",jQuery(artsy.pathImageBox).find(artsy.pathInputImageTitle).val());jQuery(artsy.imageID).attr("alt",jQuery(artsy.pathImageBox).find(artsy.pathInputImageAlt).val());jQuery(artsy.imageID).attr("cap",jQuery(artsy.pathImageBox).find(artsy.pathInputImageCap).val());jQuery(artsy.imageID).attr("link",jQuery(artsy.pathImageBox).find(artsy.pathInputImageLink).val());width=jQuery(artsy.pathImageBox).find(artsy.pathInputImageWidth).val();height=jQuery(artsy.pathImageBox).find(artsy.pathInputImageHeight).val();if(isNaN(width)==false&&width>0){jQuery(artsy.imageID).attr("width",width);jQuery(artsy.imageID).css("width",width)}if(isNaN(height)==false&&height>0){jQuery(artsy.imageID).attr("height",height);jQuery(artsy.imageID).css("height",height)}};artsy.submitImageForm=function(){artsy.editImageForm();artsy.closeImageBox()};artsy.clearImageTitle=function(){jQuery(artsy.pathImageBox).find(artsy.pathInputImageTitle).val("");jQuery(artsy.pathImageBox).find(artsy.pathInputImageTitle).focus();jQuery(artsy.imageID).attr("title","")};artsy.clearImageAlt=function(){jQuery(artsy.pathImageBox).find(artsy.pathInputImageAlt).val("");jQuery(artsy.pathImageBox).find(artsy.pathInputImageAlt).focus();jQuery(artsy.imageID).attr("alt","")};artsy.clearImageCap=function(){jQuery(artsy.pathImageBox).find(artsy.pathInputImageCap).val("");jQuery(artsy.pathImageBox).find(artsy.pathInputImageCap).focus();jQuery(artsy.imageID).attr("cap","")};artsy.clearImageLink=function(){jQuery(artsy.pathImageBox).find(artsy.pathInputImageLink).val("");jQuery(artsy.pathImageBox).find(artsy.pathInputImageLink).focus();jQuery(artsy.imageID).attr("link","")};artsy.originalSize=function(a){width=jQuery(a).data("width");height=jQuery(a).data("height");jQuery(artsy.imageID).attr("width",width);jQuery(artsy.imageID).attr("height",height);jQuery(artsy.imageID).css("width",width);jQuery(artsy.imageID).css("height",height);jQuery(artsy.pathInputImageWidth).val(width);jQuery(artsy.pathInputImageHeight).val(height)};artsy.deleteImage=function(a){parent=jQuery(artsy.imageID).parent();if(jQuery(parent).attr("class")=="artsy-resize-image"){jQuery(parent).remove()}else{if(jQuery(parent).parent().attr("class")=="artsy-resize-image"){jQuery(parent).parent().remove()}}artsy.toggleImageBox()};artsy.openImageBox=function(c){artsy.clearLink('a[href="artsy-link-'+artsy.currentRandomID+'"]');jQuery(artsy.pathEditorBox).css("display","none");jQuery(artsy.pathImageBox).fadeIn("fast");if(typeof c.clientY=="undefined"){clientY=artsy.windowHeight/2}else{clientY=c.clientY}if(typeof c.clientX=="undefined"){clientX=artsy.windowWidth/2}else{clientX=c.clientX}if(typeof c.pageY=="undefined"){pageY=artsy.documentHeight/2}else{pageY=c.pageY}if(typeof c.pageX=="undefined"){pageX=artsy.documentWidth/2}else{pageX=c.pageX}var a=pageY+20;var b=pageX-150;var f=artsy.documentHeight-pageY;var d=artsy.documentWidth-pageX;if(b<10){b=10}if(d<170){b=artsy.documentWidth-330}if(artsy.windowHeight-clientY<140){a=pageY-140}if(typeof c.pageX=="undefined"||typeof c.pageY=="undefined"){a=clientY;b=clientX-140}jQuery(artsy.pathImageBox).css("left",b+"px").css("top",a+"px");jQuery(artsy.pathInputImageTitle).focus();jQuery(artsy.pathImageBox).find("#bottom2 #return-to-default").click(function(){artsy.restoreImageSize(artsy.imageID)});jQuery(artsy.pathImageBox).find(artsy.pathInputImageTitle).val(jQuery(artsy.imageID).attr("title"));jQuery(artsy.pathImageBox).find(artsy.pathInputImageAlt).val(jQuery(artsy.imageID).attr("alt"));jQuery(artsy.pathImageBox).find(artsy.pathInputImageCap).val(jQuery(artsy.imageID).attr("cap"));jQuery(artsy.pathImageBox).find(artsy.pathInputImageLink).val(jQuery(artsy.imageID).attr("link"));jQuery(artsy.pathImageBox).find(artsy.pathInputImageWidth).val(jQuery(artsy.imageID).attr("width"));jQuery(artsy.pathImageBox).find(artsy.pathInputImageHeight).val(jQuery(artsy.imageID).attr("height"));jQuery(artsy.pathImageBox).find("form").submit(function(){artsy.submitImageForm();return false});jQuery(artsy.pathImageBox+" "+artsy.pathInputImageAlt+", "+artsy.pathImageBox+" "+artsy.pathInputImageTitle+", "+artsy.pathImageBox+" "+artsy.pathInputImageCap+", "+artsy.pathImageBox+" "+artsy.pathInputImageLink).keyup(function(){artsy.editImageForm()});jQuery(artsy.pathImageBox+" "+artsy.pathInputImageWidth+", "+artsy.pathImageBox+" "+artsy.pathInputImageHeight).blur(function(){artsy.editImageForm()});jQuery(artsy.pathImageBox).find("#clear-input-image-title").click(function(){artsy.clearImageTitle();return false});jQuery(artsy.pathImageBox).find("#clear-input-image-alt").click(function(){artsy.clearImageAlt();return false});jQuery(artsy.pathImageBox).find("#clear-input-image-cap").click(function(){artsy.clearImageCap();return false});jQuery(artsy.pathImageBox).find("#clear-input-image-link").click(function(){artsy.clearImageLink();return false});jQuery(artsy.pathImageBox).find("#top .artsy-button").each(function(){jQuery(this).click(function(){artsy.doImageAlign(jQuery(this).attr("id"),artsy.imageID)})});jQuery(artsy.pathOriginalSize).click(function(){artsy.originalSize(artsy.imageID);return false});jQuery(artsy.pathDeleteImage).click(function(){artsy.deleteImage(artsy.imageID);return false})};artsy.closeImageBox=function(){jQuery(artsy.pathImageBox).find("#top .artsy-button").each(function(){jQuery(this).unbind("click")});jQuery(artsy.pathImageBox).fadeOut("fast")};artsy.toggleImageBox=function(a){if(jQuery(artsy.pathImageBox).css("display")=="none"){artsy.openImageBox(a)}else{artsy.closeImageBox()}};artsy.openSettingsBox=function(){jQuery(".artsy-submit").find("div").text("Save!");jQuery(artsy.pathSettingsBox).find(".action-links").find("a").click(function(){action=jQuery(this).attr("id").split("-");jQuery(this).siblings().removeClass("active");jQuery(this).addClass("active");jQuery(artsy.pathSettingsBox).find('div[class^="group-"]').hide();jQuery(".group-"+action[1]).show();jQuery(artsy.pathSettingsBox).center(true).css("z-index","1005")});cloneHTML=artsy.getOuterHTML(artsy.pathCancelSettings);jQuery(jQuery(artsy.pathCancelSettings)[0]).after(cloneHTML.replace('type="button" ','type="reset" '));jQuery(jQuery(artsy.pathCancelSettings)[0]).remove();jQuery(artsy.pathCancelSettings).click(function(){artsy.toggleSettingsBox()});jQuery(artsy.pathSettingsBox).fadeIn("fast").center(true).css("z-index","1005");jQuery(artsy.pathMask).fadeIn("fast")};artsy.closeSettingsBox=function(){if(jQuery(artsy.pathSettingsBox).css("display")!="none"){jQuery("#artsy_font").text(artsy.settingsFontOriginal);jQuery("#artsy_font-size").text(artsy.settingsFontSizeOriginal);jQuery("#artsy_background").text(artsy.settingsBackgroundOriginal);jQuery("#artsy_show-word-count").text(artsy.settingsShowWordCountOriginal);jQuery(artsy.pathSettingsBox).find("#font").val(artsy.settingsFontOriginal);jQuery(artsy.pathSettingsBox).find("#font-size").val(artsy.settingsFontSizeOriginal);jQuery(artsy.pathSettingsBox).find("#background").val(artsy.settingsBackgroundOriginal);artsy.settingsFormChange("#font");artsy.settingsFormChange("#font-size");artsy.settingsFormChange("#background");artsy.settingsFormChange("#show-word-count");jQuery(artsy.pathSettingsBox).fadeOut("fast");jQuery(artsy.pathMask).fadeOut("fast")}};artsy.toggleSettingsBox=function(){if(jQuery(artsy.pathSettingsBox).css("display")=="none"){artsy.openSettingsBox()}else{artsy.closeSettingsBox()}};artsy.closeAllBoxes=function(){artsy.closeSettingsBox();artsy.closeEditorBox();artsy.closeImageBox()};artsy.settingsFormChange=function(b){val=jQuery(b).val();id=jQuery(b).attr("id");jQuery("#artsy_"+id).html(val);if(id=="font"){jQuery(artsy.pathContent).css("font-family",val+", sans-serif");jQuery(artsy.pathTitle).css("font-family",val+", sans-serif");artsy.settingsFont=val}if(id=="font-size"){titleVal=val-1+5;lineHeightVal=val*1.5;b=artsy.pathContent+", "+artsy.pathContent+" p, "+artsy.pathContent+" blockquote, "+artsy.pathContent+" ul, "+artsy.pathContent+" ol";jQuery(b).css("font-size",val+"px");jQuery(b).css("line-height",lineHeightVal+"px");jQuery(artsy.pathTitle).css("font-size",titleVal+"px");artsy.settingsFontSize=val}if(id=="background"){jQuery(artsy.backgroundStyleID).remove();var a=str_replace(" ","-",strtolower(val));jQuery(artsy.pathStyleBlock).append('<link rel="stylesheet" media="screen" href="'+artsy_plugin_path+"/css/backgrounds/"+a+'.css" id="artsy-background-css" />');artsy.settingsBackground=val}if(id=="show-word-count"){val=jQuery('input[name="show-word-count"]:checked').val();if(val==0){jQuery(artsy.pathWordCount).hide()}else{jQuery(artsy.pathWordCount).show()}artsy.settingsBackground=val}};artsy.submitSettingsForm=function(){var data={action:"submitSettings",settings:{font:jQuery("#artsy_font").text(),font_size:jQuery("#artsy_font-size").text(),background:jQuery("#artsy_background").text(),show_word_count:jQuery("#artsy_show-word-count").text(),open_automatically:jQuery("#artsy_open-automatically").text(),open_in:jQuery("#artsy_open-in").text()}};jQuery(".artsy-submit").find("div").text("Working");jQuery.post(ajaxurl,data,function(response){artsy.settingsFontOriginal=jQuery("#artsy_font").text();artsy.settingsFontSizeOriginal=jQuery("#artsy_font-size").text();artsy.settingsBackgroundOriginal=jQuery("#artsy_background").text();artsy.settingsShowWordCountOriginal=jQuery("#artsy_show-word-count").text();response=eval("("+response+")");jQuery(artsy.pathSettingsBox).find(".group-settings").html(response);jQuery(".artsy-submit").find("div").text("Good!");clearTimeout(timer4);timer4=setTimeout("artsy.toggleSettingsBox();",250);jQuery(artsy.pathSettingsBox+" select, "+artsy.pathSettingsBox+" input").change(function(){artsy.settingsFormChange(this)});jQuery(artsy.pathCancelSettings).click(function(){artsy.toggleSettingsBox()})})};artsy.doImageAlign=function(c,b){var a=c.split("-");jQuery(b).removeClass("alignnone alignleft aligncenter alignright");switch(a[1]){case"alignImageLeft":jQuery(b).addClass("alignleft");jQuery(b).parent().css("float","left");jQuery(b).parent().css("text-align","left");jQuery(b).next().removeClass("ui-resizable-sw").addClass("ui-resizable-se");break;case"alignImageMiddle":jQuery(b).addClass("aligncenter");jQuery(b).parent().css("float","none");jQuery(b).parent().css("text-align","center");jQuery(b).next().removeClass("ui-resizable-sw").addClass("ui-resizable-se");break;case"alignImageRight":jQuery(b).addClass("alignright");jQuery(b).parent().css("float","right");jQuery(b).parent().css("text-align","right");jQuery(b).next().removeClass("ui-resizable-se").addClass("ui-resizable-sw");break;case"alignImageNone":jQuery(b).addClass("alignnone");jQuery(b).parent().css("float","none");jQuery(b).parent().css("text-align","left");jQuery(b).next().removeClass("ui-resizable-sw").addClass("ui-resizable-se");break}};artsy.parseText=function(a){a=artsy.parseURL(a);a=artsy.parseEmail(a);a=artsy.parseUsername(a);a=artsy.parseHashtag(a);a=artsy.preventLinkWithinLinks(a);return a};artsy.parseURL=function(a){return a.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(b){return b.link(b)})};artsy.parseEmail=function(a){return a.replace(/[0-9a-zA-Z]+@[0-9a-zA-Z]+[\.]{1}[0-9a-zA-Z]+[\.]?[0-9a-zA-Z]{2,4}/g,function(b){return b.link("mailto:"+b)})};artsy.parseUsername=function(a){return a.replace(/[@]+([A-Za-z0-9_]+)+[^A-Za-z0-9._]/g,function(b){b=b.replace(" ","");var c=b.replace("@","");return b.link("http://twitter.com/"+c)+" "})};artsy.parseHashtag=function(a){return a.replace(/[#]+([A-Za-z0-9-_]+)+[^A-Za-z0-9_]/g,function(c){c=c.replace(" ","");var b=c.replace("#","%23");return c.link("http://search.twitter.com/search?q="+b)+" "})};artsy.preventLinkWithinLinks=function(a){return a.replace(/<a [^>]+?(<a [^>]+?>)[^>]+?<\/a>[^>]+?>([^>]+?)<\/a>/ig,"$1$2</a>")};artsy.clearLink=function(a){jQuery(a).after(jQuery(a).text());jQuery(a).remove()};artsy.getCursorPosition=function(){jQuery(artsy.pathCurrentPosition).remove();selection=artsy.saveSelection();var c,a,b;if(window.getSelection){c=window.getSelection();if(c.getRangeAt&&c.rangeCount){a=c.getRangeAt(0);span=document.createElement("span");span.setAttribute("id","current-position");a.insertNode(span)}else{jQuery(artsy.pathContent).prepend('<span id="current-position"></span>')}}else{if(document.selection&&document.selection.createRange){a=document.selection.createRange();a.pasteHTML(text)}}artsy.restoreSelection(selection)};artsy.saveSelection=function(){if(window.getSelection){sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){return sel.getRangeAt(0)}}else{if(document.selection&&document.selection.createRange){return document.selection.createRange()}}return null};artsy.restoreSelection=function(a){if(a){if(window.getSelection){sel=window.getSelection();sel.removeAllRanges();sel.addRange(a)}else{if(document.selection&&a.select){a.select()}}}};artsy.getSelected=function(){if(window.getSelection){artsy.selection=window.getSelection();artsy.selectedText=artsy.selection.toString()}else{if(document.getSelection){artsy.selection=document.getSelection();artsy.selectedText=artsy.selection.getSelection()}else{if(document.selection){artsy.selection=document.selection.createRange();artsy.selectedText=artsy.selection.text}}}if(artsy.selectedText!=""){range=artsy.selection.getRangeAt(0)}if(typeof artsy.selection=="undefined"){artsy.commonAncestorContainer=artsy.selection.getRangeAt(0).commonAncestorContainer.parentNode}if(artsy.selectedText!=""){artsy.rangeStart=range.startOffset;artsy.rangeEnd=range.endOffset;artsy.rangeElementStart=range.startContainer;artsy.rangeElementEnd=range.endContainer;if(range.commonAncestorContainer.nodeName=="A"){artsy.parentElementHref=range.commonAncestorContainer.getAttribute("href");artsy.parentElementTarget=range.commonAncestorContainer.getAttribute("target")}else{if(range.commonAncestorContainer.parentNode.nodeName=="A"){artsy.parentElementHref=range.commonAncestorContainer.parentNode.getAttribute("href");artsy.parentElementTarget=range.commonAncestorContainer.parentNode.getAttribute("target")}else{if(range.commonAncestorContainer.parentNode.parentNode.nodeName=="A"){artsy.parentElementHref=range.commonAncestorContainer.parentNode.parentNode.getAttribute("href");artsy.parentElementTarget=range.commonAncestorContainer.parentNode.parentNode.getAttribute("target")}else{artsy.parentElementHref="";artsy.parentElementTarget=""}}}if(jQuery(range.commonAncestorContainer).attr("id")=="artsy-editor-content"){artsy.selectionParents=jQuery(range.commonAncestorContainer).get()}else{artsy.selectionParents=jQuery(range.commonAncestorContainer).parents()}artsy.selectedInContent=false;artsy.foundFormatBlock=false;artsy.commonFormatBlock=false;if(artsy.browser=="gecko"){artsy.selectionParents=jQuery(artsy.selectionParents).get().reverse()}jQuery(artsy.selectionParents).each(function(){if(artsy.selectedInContent==false&&jQuery(this).attr("id")=="artsy-editor-content"){artsy.selectedInContent=true}if(artsy.foundFormatBlock==false&&jQuery.inArray(this.nodeName.toLowerCase(),artsy.formatBlocks)!=-1){artsy.commonFormatBlock=["<"+this.nodeName.toLowerCase()+">"];artsy.foundFormatBlock=true}});artsy.doWordCount(artsy.selectedText)}else{artsy.doWordCount(false)}};artsy.openJunk=function(){if(artsy.junkOpen==false){artsy.junkOpen=true;jQuery(artsy.pathMenu).fadeIn();color="#cccccc";jQuery(artsy.pathTitle).add(artsy.pathContent).animate({"border-top-color":color,"border-left-color":color,"border-right-color":color,"border-bottom-color":color},400)}clearTimeout(timer1);timer1=setTimeout("artsy.closeJunk()",3000)};artsy.closeJunk=function(){if(artsy.junkOpen==true){artsy.junkOpen=false;jQuery(artsy.pathMenu).fadeOut("slow");color="#"+artsy.determineColor(jQuery("#artsy_background").text());jQuery(artsy.pathTitle).add(artsy.pathContent).animate({"border-top-color":color,"border-left-color":color,"border-right-color":color,"border-bottom-color":color},600)}};artsy.doWordCount=function(a){if(a==false){text=jQuery(artsy.pathContent).text()}else{text=a}var c=text.split(" ").length;var b=text.length;if(c<0){c=0}if(b<0){b=0}if(a==false){c=c-1;b=b-1}jQuery(artsy.pathWordCount).text("Word: "+c+" - Character: "+b)};artsy.restoreImageSize=function(a){a=jQuery(a).attr(artsy.imageIdentifier);for(var b in artsy.originalSizes){if(artsy.originalSizes[b].id==a){a="img["+artsy.imageIdentifier+"="+a+"]";jQuery(a).width(artsy.originalSizes[b].width);jQuery(a).parent("div").width(artsy.originalSizes[b].width);jQuery(a).height(artsy.originalSizes[b].height);jQuery(a).parent("div").height(artsy.originalSizes[b].height)}}};artsy.changeHeaderButton=function(a){a=a.substr(1,2);jQuery(artsy.pathEditorBox).find(".show-header").attr("title",a);jQuery(artsy.pathEditorBox).find(".show-header").attr("id","action-"+a)};artsy.getImageTag=function(b,a,c,h,g,d,i,f,e,j){if(b!=""){wpid=" wp-image-"+b}if(c>774){percentage=Math.round(774/c*100);h=Math.round(percentage*h/100);c=774}return"<img "+artsy.imageIdentifier+'="'+artsy.generateRandomID()+'" class="align'+e+" size-"+j+wpid+'" title="'+g+'" src="'+a+'" alt="'+d+'" link="'+f+'" width="'+c+'" height="'+h+'" cap="'+i+'" attachment-id="attachment_'+b+'">'};artsy.loadBackgroundCSS=function(a){if(!a){var a=artsy_background}var a=str_replace(" ","-",strtolower(a));jQuery(artsy.backgroundStyleID).remove();jQuery("body").append('<link rel="stylesheet" media="screen" href="'+artsy_plugin_path+"/css/backgrounds/"+a+'.css" id="artsy-background-css" />');artsy.settingsBackground=a};artsy.determineColor=function(a){a=strtolower(a);switch(a){case"light yellow":return"EEEEDE";break;case"light green":return"F3FFEE";break;case"light blue":return"EEF9FF";break;case"light grey":return"F3F3F3";break;case"dark grey":return"333333";break;case"white":return"FFFFFF";break;default:return"EEEEDE";break}};artsy.determineColorText=function(a){a=strtolower(a);if(a=="white"){return"000000"}if(a.substr(0,5)=="light"){return"333333"}else{return"EEEEEE"}};artsy.getOuterHTML=function(a){return jQuery(a).clone().wrap("<div></div>").parent().html()};artsy.generateRandomID=function(){artsy.currentRandomID=Math.floor(Math.random()*10000);return artsy.currentRandomID};delete switchEditors.go;switchEditors.go=function(g,f){g=g||"content";f=f||"toggle";var c=this,b=tinyMCE.get(g),a,d,e=tinymce.DOM;a="wp-"+g+"-wrap";d=e.get(g);if("toggle"==f){if(b&&!b.isHidden()){f="html"}else{f="tmce"}}if("tmce"==f||"tinymce"==f){if(b&&!b.isHidden()){return false}if(typeof(QTags)!="undefined"){QTags.closeAllTags(g)}if(tinyMCEPreInit.mceInit[g]&&tinyMCEPreInit.mceInit[g].wpautop){d.value=c.wpautop(d.value)}if(b){b.show()}else{b=new tinymce.Editor(g,tinyMCEPreInit.mceInit[g]);b.render()}e.removeClass(a,"html-active");e.addClass(a,"tmce-active");setUserSetting("editor","tinymce")}else{if("html"==f){if(b&&b.isHidden()){return false}if(b){d.style.height=b.getContentAreaContainer().offsetHeight+20+"px";b.hide()}e.removeClass(a,"tmce-active");e.addClass(a,"html-active");setUserSetting("editor","html")}else{if("artsy"==f){jQuery("#edButtonArtsy").data("editor_type",jQuery("#editor-toolbar").find("a[class^=active]").attr("id"));jQuery("#edButtonArtsy").addClass("active");setUserSetting("editor","artsy");this.mode="artsy";e.removeClass(a,"html-active");e.removeClass(a,"tmce-active");artsy.runEditor();artsy.hasSetup=true}}}return false};function strtolower(a){return(a+"").toLowerCase()}function str_replace(t,c,m,l){var g=0,e=0,p="",k="",d=0,o=0,h=[].concat(t),a=[].concat(c),q=m,b=Object.prototype.toString.call(a)==="[object Array]",n=Object.prototype.toString.call(q)==="[object Array]";q=[].concat(q);if(l){this.window[l]=0}for(g=0,d=q.length;g<d;g++){if(q[g]===""){continue}for(e=0,o=h.length;e<o;e++){p=q[g]+"";k=b?(a[e]!==undefined?a[e]:""):a[0];q[g]=(p).split(h[e]).join(k);if(l&&q[g]!==p){this.window[l]+=(p.length-q[g].length)/h[e].length}}}return n?q:q[0]}function strip_tags(a,c){c=(((c||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var b=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(b,function(f,e){return c.indexOf("<"+e.toLowerCase()+">")>-1?f:""})}jQuery.fn.center=function(a){return this.each(function(){var b=jQuery(this);b.css({position:a?"absolute":"fixed",left:"50%",top:"50%",zIndex:"99"}).css({marginLeft:"-"+(b.outerWidth()/2)+"px",marginTop:"-"+(b.outerHeight()/2)+"px"});if(a){b.css({marginTop:parseInt(b.css("marginTop"),10)+jQuery(window).scrollTop(),marginLeft:parseInt(b.css("marginLeft"),10)+jQuery(window).scrollLeft()})}})};